<!-- An Interactive Map built based on Leaflet.js-->
<!DOCTYPE html>
<html>
    <head>
        <!-- Importing the required Leaflet library -->
        <title>Interactive Map with Leaflet</title>
        <meta charset="UTF-8">
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css">
        <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>

        <!-- Importing leaflet-provider plugin for EZ switch between base map tiles-->
        <script src="http://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
        <script src="./leaflet-providers.js"></script>


        <!-- Importing JQuery and Papaparse to load csv files-->
        <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.0/papaparse.min.js"></script>

        <!--Importing Leaflet Ajax to work on GeoJson-->
        <script src="./leaflet.ajax.min.js"></script>

        <!-- Import the heatmap plugin-->
        <script src="./leaflet-heat.js"></script>

    </head>

    <body>
        <div id="container">
            <div id="map" style="height: 100vh;width: 50vw;"></div> <!-- Set Height to 100% of the browser window-->
            
            <script>
                var map = L.map('map',{preferCanvas: true}).setView([39.5,-98.35],3); //Initialize map, LatLng and initial zoom level
            
                var OpenStreetMap = L.tileLayer.provider('OpenStreetMap.Mapnik',{updateWhenIdle: true,updateWhenZooming:true}),
                    Stadia        = L.tileLayer.provider('Stadia.AlidadeSmooth',{updateWhenIdle: true,updateWhenZooming:true});

                OpenStreetMap.addTo(map);

                L.control.scale({updateWhenIdle: true,position:"bottomright"}).addTo(map);

                //Declaring the filter variables
                var Music ="all",
                    PriceRange ="all",
                    Stars ="all",
                    RestaurantsDelivery="all",
                    GoodForKids="all",
                    Appointment = "all";

                //Setting up the helper filter function
                FilterMusic = function(data){
                    if(Music=="all"){
                        return data;
                    }
                    else 
                        return data.filter(x => x.properties.Music==Music);
                    }

                FilterGood4Kids = function(data){
                if(GoodForKids=="all"){
                    return data;
                }
                else
                    return data.filter(x => x.properties.attributes.GoodForKids==GoodForKids);
                }

                FilterStars = function(data){
                if(Stars=="all"){
                    return data;
                }
                else 
                    return data.filter(x => x.properties.stars==Stars);
                }

                FilterRestaurantDelivery = function(data){
                if(RestaurantsDelivery=="all"){
                    return data;
                }
                else 
                    return data.filter(x => x.properties.attributes.RestaurantsDelivery==RestaurantsDelivery);
                }

                FilterAppointment = function(data){
                    if(Appointment=="all"){
                        return data;
                    }
                    else 
                        return data.filter(x => x.properties.attributes.ByAppointmentOnly==Appointment);
                    }

                FilterPriceRange = function(data){
                if(PriceRange=="all"){
                    return data;
                }
                else 
                    return data.filter(x => x.properties.attributes.RestaurantPriceRange2==PriceRange);
                }

                
                
                
                //Dynamically updating the Bubbleplot
                EditBubbleplot = function(Dataset){
                    bubbleplot.clearLayers();
                    Dataset.forEach(element => {
                        var marker = L.circleMarker([element.properties.latitude,element.properties.longitude],{radius:8,stroke: false, fillOpacity:0.8, fillColor: Getcolor(element)}).bindPopup(PopUpContent(element));
                        bubbleplot.addLayer(marker);
                    });
                }

                FilterDataset = function(OriginalData){
                    Intermediate = FilterAppointment(OriginalData);
                    Intermediate = FilterGood4Kids(Intermediate);
                    Intermediate = FilterPriceRange(Intermediate);
                    Intermediate = FilterRestaurantDelivery(Intermediate);
                    Intermediate = FilterMusic(Intermediate);
                    Result = FilterStars(Intermediate);
                    return Result;
                }
            
            
            
                //Get the csv file --> On success runs the following command (JavaScript Asynchornus Nature LUL)
                $.getJSON("./food_only_fullattr.geojson",function(data){
                    console.log(data);
                    
                    bubbleplot = L.layerGroup();
                    //Building the bubble plot
                    EditBubbleplot(data);
                    
                    //Building the heat plot
                    LatLongCount = data.map(a=> [a.properties.latitude,a.properties.longitude,a.properties.review_count/(100)]); //Divide review count by 9185(max.val), then ten-fold the intensity
                    heat = L.heatLayer(LatLongCount,{radius: 25});
                    //bubbleplot.addTo(map);

                    //Layer Controls
                    var baseLayers = {
                        "OpenStreetMap":OpenStreetMap,
                        "Stadia":Stadia
                    };

                    var Overlays = {
                        "Bubbleplot":bubbleplot,
                        "HeatMap":heat
                    };

                    L.control.layers(baseLayers,Overlays).addTo(map);
                    //Potential Sol to dynamic update
                    //bubbleplot.remove();
                    $(".RadioButton").on("click",function () {
                        Ambience = $("input[name='ambience_radio']:checked").val();
                        Music = $("input[name='music_radio']:checked").val();
                        PriceRange = $("input[name='PriceRange_radio']:checked").val();
                        Stars = $("input[name='stars_radio']:checked").val();
                        if (Stars !== 'all') { Stars = +(Stars) }
                        RestaurantsDelivery = $("input[name='RestaurantsDelivery_radio']:checked").val();
                        GoodForKids = $("input[name='GoodForKids_radio']:checked").val();
                        Appointment = $("input[name='ByAppointmentOnly_radio']:checked").val();

                        Changes = FilterDataset(data);
                        EditBubbleplot(Changes);
                    })

                })

            //Function prototype for obtaining colours, credit to Siyuan
            var Getcolor = function (feature) {
                if (feature.properties.categories.includes('Mexican')) {
                    return 'black'
                }
                else if (feature.properties.categories.includes('Italian')) {
                    return '#3498DB'//blue
                }
                else if (feature.properties.categories.includes('Chinese')) {
                    return '#E74C3C'//red
                }
                else if (feature.properties.categories.includes('Indian')) {
                    return 'yellow'
                }
                else if (feature.properties.categories.includes('Sushi') || feature.properties.categories.includes('Japnese')) {
                    return '#FADBD8'//pink
                }
                else if (feature.properties.categories.includes('Middle Eastern')) {
                    return '#7E5109'//brown
                }
                else if (feature.properties.categories.includes('French')) {
                    return '#76448A'//purple
                }
                else if (feature.properties.categories.includes('Korean')) {
                    return '#1ABC9C'//green
                }

                else { return 'grey' }
            }
            
            //Function prototype to generate
            var PopUpContent = function (feature) {
                //Returning a String (In HTML Code format)
                return '<p>Name: ' + feature.properties.name + 
                    '<br /> Address: ' + feature.properties.address + '<br />Stars: '  
                    //+ Adding a picture that's done alrdy
                    //Add a section of html code that runs the wordcloud generating function.
                    //HTML Wrapper which calls a Python Script to run a word cloud --> HTML --> JS --> Python
                    + feature.properties.stars +'<p>'
            } 
            </script>

            
            <!-- Section for inserting the Tableau Dashboard Overlay-->
            <div class='tableauPlaceholder' id='viz1637671489980' style='position: relative'><noscript>
                <a href='#'><img alt='TheStory  ' src='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;HG&#47;HGQMC4ZYP&#47;1_rss.png' style='border: none' />
                </a></noscript>
                <object class='tableauViz'  style='display:none;'>
                    <param name='host_url' value='https%3A%2F%2Fpublic.tableau.com%2F' /> 
                    <param name='embed_code_version' value='3' /> <param name='path' value='shared&#47;HGQMC4ZYP' /> 
                    <param name='toolbar' value='yes' />
                    <param name='static_image' value='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;HG&#47;HGQMC4ZYP&#47;1.png' /> 
                    <param name='animate_transition' value='yes' /><param name='display_static_image' value='yes' /><param name='display_spinner' value='yes' />
                    <param name='display_overlay' value='yes' /><param name='display_count' value='yes' /><param name='language' value='en-US' />
                </object>
            </div>

            <script type='text/javascript'>                    
                var divElement = document.getElementById('viz1637671489980');                    
                var vizElement = divElement.getElementsByTagName('object')[0];                   
                vizElement.style.width='50vw';vizElement.style.height='100vh';                    
                var scriptElement = document.createElement('script');                    
                scriptElement.src = 'https://public.tableau.com/javascripts/api/viz_v1.js';                   
                vizElement.parentNode.insertBefore(scriptElement, vizElement);                
            </script>

            <!-- Section of Menu Controls-->

            <!--div element for the entire dropup menu-->
            <div class="Filter_Dropdown">

                <!--Pop-Up Content-->
                <div id="Filters" >


                    <!--Radio Buttons of all are initialized to be checked.-->
                    <div id="Ambience" class="Radio">
                        Ambience:&nbsp;
                        <input type="radio" name="ambience_radio" class="RadioButton" value='romantic'> Romantic
                        <input type="radio" name="ambience_radio" class="RadioButton" value='casual'> Casual
                        <input type="radio" name="ambience_radio" class="RadioButton" value='upscale'> Upscale
                        <input type="radio" name="ambience_radio" class="RadioButton" value='classy'> Classy
                        <input type="radio" name="ambience_radio" class="RadioButton" value='intimate'> Intimate
                        <input type="radio" name="ambience_radio" class="RadioButton" value='hipster'> Hipster
                        <input type="radio" name="ambience_radio" class="RadioButton" value='touristy'> Touristy
                        <input type="radio" name="ambience_radio" class="RadioButton" value='divey'> Divey
                        <input type="radio" name="ambience_radio" class="RadioButton" value='trendy'> Trendy
                        <input type="radio" name="ambience_radio" class="RadioButton" value='all'> All
                
                    </div>
                    <div id="Music" class="Radio">
                        Music:&nbsp;
                        <input type="radio" name="music_radio" value='dj' class="RadioButton"> DJ
                        <input type="radio" name="music_radio" value='background_music' class="RadioButton"> Background&nbsp;Music
                        <input type="radio" name="music_radio" value='no_music' class="RadioButton"> No&nbsp;Music
                        <input type="radio" name="music_radio" value='jukebox'class="RadioButton"> Jukebox
                        <input type="radio" name="music_radio" value='live' class="RadioButton"> Live
                        <input type="radio" name="music_radio" value='video' class="RadioButton"> Video
                        <input type="radio" name="music_radio" value='karaoke' class="RadioButton"> Karaoke
                        <input type="radio" name="music_radio" value='all' class="RadioButton" checked="checked"> All
                    </div>

                    <div id="PriceRange" class="Radio">
                        PriceRange:&nbsp;
                        <input type="radio" name="PriceRange_radio" value='1' class="RadioButton"> 1
                        <input type="radio" name="PriceRange_radio" value='2' class="RadioButton"> 2
                        <input type="radio" name="PriceRange_radio" value='3' class="RadioButton"> 3
                        <input type="radio" name="PriceRange_radio" value='4' class="RadioButton"> 4
                        <input type="radio" name="PriceRange_radio" value='all'class="RadioButton" checked="checked"> All
                    </div>

                    <div id="Stars" class="Radio">
                        Stars:&nbsp;
                        <input type="radio" name="stars_radio" value=1.0 class="RadioButton"> 1
                        <input type="radio" name="stars_radio" value=1.5 class="RadioButton"> 1.5
                        <input type="radio" name="stars_radio" value=2.0 class="RadioButton"> 2
                        <input type="radio" name="stars_radio" value=2.5 class="RadioButton"> 2.5
                        <input type="radio" name="stars_radio" value=3.0 class="RadioButton"> 3
                        <input type="radio" name="stars_radio" value=3.5 class="RadioButton"> 3.5
                        <input type="radio" name="stars_radio" value=4.0 class="RadioButton"> 4
                        <input type="radio" name="stars_radio" value=4.5 class="RadioButton"> 4.5
                        <input type="radio" name="stars_radio" value=5.0 class="RadioButton"> 5
                        <input type="radio" name="stars_radio" value='all' class="RadioButton" checked="checked"> All
                    </div>

                    <div id="Restaurant Delivery" class="Radio">
                        Restaurant&nbsp;Delivery:&nbsp;
                        <input type="radio" name="RestaurantsDelivery_radio" value="True" class="RadioButton"> True
                        <input type="radio" name="RestaurantsDelivery_radio" value="False" class="RadioButton"> False
                        <input type="radio" name="RestaurantsDelivery_radio" value='all' class="RadioButton" checked="checked"> All
                    </div>
                    <div id="Good For Kids" class="Radio">
                        Good&nbsp;For&nbsp;Kids:&nbsp;
                        <input type="radio" name="GoodForKids_radio" value="True" class="RadioButton"> True
                        <input type="radio" name="GoodForKids_radio" value="False" class="RadioButton"> False
                        <input type="radio" name="GoodForKids_radio" value='all' class="RadioButton" checked="checked"> All
                    </div>
                    <div id="ByAppointmentOnly" class="Radio">
                        By&nbsp;Appointment&nbsp;Only:&nbsp;
                        <input type="radio" name="ByAppointmentOnly_radio" value="True" class="RadioButton"> True
                        <input type="radio" name="ByAppointmentOnly_radio" value="False" class="RadioButton"> False
                        <input type="radio" name="ByAppointmentOnly_radio" value='all'class="RadioButton" checked="checked"> All
                    </div>


                </div>
                <!--Button to Open Menu-->
                <div id="Button">
                <button class="Button" onclick="ShowMenu()">Filter Menu</button>
                </div>
                
            </div>

            <!-- JavaScript to control showing Filter Menus-->
            <script>
                function ShowMenu(){
                    var Filters = document.getElementById("Filters");
                    if(Filters.style.display === "none"){
                        Filters.style.display = "block";
                    }
                    else{
                        Filters.style.display = "none";
                    }

                }
            </script>

        </div>
    </body>

</html>


<!-- Style Section for all the parts-->
 <!--Styling Section-->
 <style>
    html, body { 
        height: 100%; 
        margin: 0 !important;
        padding: 0 !important;
    }
    
    #container{
        display: flex;
    }
    #Filters{
        display: none;
    }

    .Filter_Dropdown {
        position: absolute;
        bottom: 0vh;
        left: 0vw;
        margin-left: 10px;
        margin-bottom: 10px;
        z-index: 2000;

    }

    .Button {
      appearance: none;
      background-color: #FAFBFC;
      border: 1px solid rgba(27, 31, 35, 0.15);
      border-radius: 6px;
      box-shadow: rgba(27, 31, 35, 0.04) 0 1px 0, rgba(255, 255, 255, 0.25) 0 1px 0 inset;
      box-sizing: border-box;
      color: #24292E;
      cursor: pointer;
      font-family: -apple-system, system-ui, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";
      font-size: 14px;
      font-weight: 500;
      line-height: 20px;
      list-style: none;
      padding: 6px 16px;
      position: relative;
      float: left;
      
      transition: background-color 0.2s cubic-bezier(0.3, 0, 0.5, 1);
      user-select: none;
      -webkit-user-select: none;
      touch-action: manipulation;
      vertical-align: middle;
      white-space: nowrap;
      word-wrap: break-word;
    }
    .Button:hover {
      background-color: #F3F4F6;
      text-decoration: none;
      transition-duration: 0.1s;
    }
    .Radio{
        background-color: #FAFBFC;
        border: 1px solid rgba(27, 31, 35, 0.15);
        border-radius: 6px;
        box-shadow: rgba(27, 31, 35, 0.04) 0 1px 0, rgba(255, 255, 255, 0.25) 0 1px 0 inset;
        width: fit-content;
        font-size: 10px;
        font-weight: 500;
        line-height: 20px;
        padding: 6px 16px;
        position: relative;
        font-family: -apple-system, system-ui, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";
    }



    </style>