<!-- An Interactive Map built based on Leaflet.js-->
<!DOCTYPE html>
<html>
    <head>
        <!-- Importing the required Leaflet library -->
        <title>Interactive Map with Leaflet</title>
        <meta charset="UTF-8">
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css">
        <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>

        <!-- Importing leaflet-provider plugin for EZ switch between base map tiles-->
        <script src="http://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
        <script src="./leaflet-providers.js"></script>


        <!-- Importing JQuery and Papaparse to load csv files-->
        <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.0/papaparse.min.js"></script>

        <!-- Import the heatmap plugin-->
        <script src="./leaflet-heat.js"></script>


    </head>

    <body>
        <div id="map" style="height:100vh"></div> <!-- Set Height to 100% of the browser window-->
        
        <script>
            var map = L.map('map',{preferCanvas: true}).setView([39.5,-98.35],3); //Initialize map, LatLng and initial zoom level
        
            L.tileLayer.provider('OpenStreetMap.Mapnik').addTo(map); //Add the base map tiles

            L.gridLayer({updateWhenIdle: true, updateWhenZooming: false}).addTo(map);


            $.get('./yelp_academic_dataset_business.csv',function(csvString){
                data = Papa.parse(csvString, {header:true, dynamicTyping: true, skipEmptyLines: true}).data; //Convert string into array of objects, need to skip empty lines to prevent it from generating a null line

                console.log(data);
           
                //data.forEach(element => {
                //    var marker = L.circleMarker([element.latitude,element.longitude],{radius:8,stroke: false, fillOpacity:0.8, fillColor: '#D32727'}).addTo(map).bindPopup(element.name);
                //});
                LatLongCount = data.map(a=> [a.latitude,a.longitude,a.review_count/9185]); //Divide review count by 9185(max.val)
                //console.log(LatLongCount);
                var heat = L.heatLayer(LatLongCount,{radius: 25}).addTo(map);

            })
        </script>
    </body>


</html>