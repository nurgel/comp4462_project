<!-- An Interactive Map built based on Leaflet.js-->
<!DOCTYPE html>
<html>

<head>
    <!-- Importing the required Leaflet library -->
    <title>Interactive Map with Leaflet</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css">
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>

    <!-- Importing leaflet-provider plugin for EZ switch between base map tiles-->
    <script src="http://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="./leaflet-providers.js"></script>


    <!-- Importing JQuery and Papaparse to load csv files-->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.0/papaparse.min.js"></script>

    <!-- Import the heatmap plugin-->
    <script src="./leaflet.ajax.min.js"></script>


</head>

<body>
    Ambience<input type="text" name="fname" value="Romantic" id='Ambience_filter' /><br />
    <button type="button" id='Ambience_button'>submmit</button>
    <div id="map" style="height:100vh"></div> <!-- Set Height to 100% of the browser window-->

    <div onclick="click"></div>

    <script>
        // initialize a map with all points on it
        var map = L.map('map', { preferCanvas: true }).setView([39.5, -98.35], 3); //Initialize map, LatLng and initial zoom level

        L.tileLayer.provider('OpenStreetMap.Mapnik', { updateWhenIdle: true, updateWhenZooming: true }).addTo(map);
        L.control.scale({ updateWhenIdle: true }).addTo(map);
        // some var declaration
        ['RestaurantsTakeOut', 'RestaurantsDelivery', 'Alcohol',
            'GoodForKids', 'OutdoorSeating', 'RestaurantsAttire',
            'BusinessAcceptsCreditCards', 'WiFi',
            'RestaurantsPriceRange2', 'BikeParking', 'NoiseLevel',
            'BusinessParking', 'RestaurantsReservations',
            'RestaurantsGoodForGroups', 'HasTV', 'BYOBCorkage',
            'Corkage', 'RestaurantsTableService', 'Caters', 'Smoking',
            'Music', 'GoodForDancing', 'ByAppointmentOnly', 'DogsAllowed',
            'HappyHour', 'WheelchairAccessible', 'BYOB', 'Ambience',
            'BestNights', 'CoatCheck', 'GoodForMeal', 'BusinessAcceptsBitcoin']
        var filterval_ambience;
        var filterval_RestaurantsTakeOut;
        var filterval_RestaurantsDelivery;
        var filterval_GoodForKids;
        var filterval_OutdoorSeating;
        var filterval_BusinessAcceptsCreditCards;
        var filterval_WiFi;
        var filterval_RestaurantsPriceRange2;
        var filterval_BikeParking;
        var filterval_NoiseLevel;
        var filterval_BusinessParking;
        var filterval_RestaurantsReservations;
        var filterval_RestaurantsGoodForGroups;
        var filterval_HasTV;
        var filterval_BYOBCorkage;
        var filterval_Corkage;
        var filterval_RestaurantsTableService;
        var filterval_Music; // this attr needs some overview to see possible values
        var filterval_Smoking;
        var filterval_GoodForDancing;
        var filterval_ByAppointmentOnly;
        var filterval_HappyHour;
        var filterval_WheelchairAccessible;
        var filterval_BYOB;
        var filterval_DogsAllowed;
        var filterval_BestNights;
        var filterval_CoatCheck;
        var filterval_GoodForMeal;
        var filterval_BusinessAcceptsBitcoin;


        var False = false;
        var True = true;
        var None = false
        var geojsonLayer = new L.GeoJSON.AJAX("../food_only_fullattr.geojson", {
            pointToLayer: function (feature, latlng) {
                return L.circleMarker(latlng, { radius: 1, fillOpacity: 0.5 });
            },
            onEachFeature: function (feature, layer) {
                layer.bindPopup(feature.properties.name);
            }
        })
        geojsonLayer.addTo(map);
        var ambience;
        var ambience_dict;
        // filter function
        var ambience_filter = function (feature) {
            ambience = feature.properties.attributes.Ambience;
            if (ambience === 'none') return false;
            try { var ambience_dict = eval('(' + ambience + ')'); }
            catch (err) { return false }
            if (ambience_dict[filterval_ambience] === true) return true
            else return false
        }

        var test_filter = function (ambience) {
            if (ambience === 'none') return false;
            try { var ambience = eval('(' + ambience + ')'); }
            catch (err) { return false }

            if (ambience[filterval_ambience] === true) return true
            else return false
        }
        function addLayerToMap() {
            //remove the layer from the map entirely
            if (map.hasLayer(geojsonLayer)) {
                geojsonLayer.remove();
            };
            //add the data layer and style based on attribute. 
            geojsonLayer = new L.GeoJSON.AJAX("../food_only_fullattr.geojson", {
                filter: ambience_filter,
                pointToLayer: function (feature, latlng) {
                    return L.circleMarker(latlng, { radius: 1, fillOpacity: 0.2 });
                },
                onEachFeature: function (feature, layer) {
                    layer.bindPopup(feature.properties.name);
                }
            }).addTo(map);

        }



        $("#Ambience_button").on("click", function () {
            filterval_ambience = document.getElementById("Ambience_filter").value;
            addLayerToMap()
        })



      

    </script>
</body>


</html>
