<!-- An Interactive Map built based on Leaflet.js-->
<!DOCTYPE html>
<html>
    <head>
        <!-- Importing the required Leaflet library -->
        <title>Interactive Map with Leaflet</title>
        <meta charset="UTF-8">
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css">
        <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>

        <!-- Importing leaflet-provider plugin for EZ switch between base map tiles-->
        <script src="http://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
        <script src="./leaflet-providers.js"></script>


        <!-- Importing JQuery and Papaparse to load csv files-->
        <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.0/papaparse.min.js"></script>

        <!-- Import the heatmap plugin-->
        <script src="./leaflet-heat.js"></script>


    </head>

    <body>
        <div id="map" style="height:100vh"></div> <!-- Set Height to 100% of the browser window-->
        
        <script>
            var map = L.map('map',{preferCanvas: true}).setView([39.5,-98.35],3); //Initialize map, LatLng and initial zoom level
        
            L.tileLayer.provider('OpenStreetMap.Mapnik',{updateWhenIdle: true,updateWhenZooming:true}).addTo(map);
            L.control.scale({updateWhenIdle: true}).addTo(map);


            //Get the csv file --> On success runs the following command (JavaScript Asynchornus Nature LUL)
            $.getJSON("./food_only(1).json",function(data){
                console.log("Works!");



        
                //Building the bubble plot
                bubbleplot = L.layerGroup();
                data.forEach(element => {
                    var marker = L.circleMarker([element.latitude,element.longitude],{radius:8,stroke: false, fillOpacity:0.8, fillColor: '#D32727'}).bindPopup(element.name);
                    bubbleplot.addLayer(marker);
                });
                //Building the heat plot
                LatLongCount = data.map(a=> [a.latitude,a.longitude,a.review_count/(9185/10)]); //Divide review count by 9185(max.val), then ten-fold the intensity
                heat = L.heatLayer(LatLongCount,{radius: 25});;
                heat.addTo(map);
                //bubbleplot.addTo(map);
                //Working on Filtering and Group Control (Resolve Z-Index Problem).
            })
        </script>
    </body>


</html>