<!-- An Interactive Map built based on Leaflet.js-->

<!DOCTYPE html>
<html>

<head>
    <!-- Importing the required Leaflet library -->
    <title>Interactive Map with Leaflet</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css">
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>

    <!-- Importing leaflet-provider plugin for EZ switch between base map tiles-->
    <script src="http://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="./leaflet-providers.js"></script>


    <!-- Importing JQuery and Papaparse to load csv files-->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.0/papaparse.min.js"></script>

    <!-- Import the heatmap plugin-->
    <script src="./leaflet.ajax.min.js"></script>


</head>

<body>
    Ambience<input type="text" name="fname" value="Romantic" id='Ambience_filter' /><br />
    <button type="button" id='Ambience_button'>submmit</button>
    <div id="map" style="height:100vh"></div> <!-- Set Height to 100% of the browser window-->

    <div onclick="click"></div>

    <script>
        // initialize a map with all points on it
        var map = L.map('map', { preferCanvas: true }).setView([39.5, -98.35], 3); //Initialize map, LatLng and initial zoom level

        L.tileLayer.provider('OpenStreetMap.Mapnik', { updateWhenIdle: true, updateWhenZooming: true }).addTo(map);
        L.control.scale({ updateWhenIdle: true }).addTo(map);
        var geojsonLayer;
        var filterval_ambience;
        var geojsonLayer = new L.GeoJSON.AJAX("geo_test.geojson", {
            pointToLayer: function (feature, latlng) {
                return L.circleMarker(latlng, { radius: 8, fillOpacity: 0.85 });
            },
            onEachFeature: function (feature, layer) {
                layer.bindPopup(feature.properties.name);
            }
        })
        geojsonLayer.addTo(map)

        // filter function
        var ambience_filter = function (feature) {
            if (feature.properties.ambience === filterval_ambience) return true
            else return false
        }

        var test_filter = function (x) {
            if (x === filterval_ambience) return true
        }
        function addLayerToMap() {
            //remove the layer from the map entirely
            if (map.hasLayer(geojsonLayer)) {
                geojsonLayer.remove();
            };
            //add the data layer and style based on attribute. 
            geojsonLayer = new L.GeoJSON.AJAX("geo_test.geojson", {
                filter: ambience_filter,
                pointToLayer: function (feature, latlng) {
                    return L.circleMarker(latlng, { radius: 8, fillOpacity: 0.85 });
                },
                onEachFeature: function (feature, layer) {
                    layer.bindPopup(feature.properties.name);
                }
            }).addTo(map);

        }



        $("#Ambience_button").on("click", function () {
            filterval_ambience = document.getElementById("Ambience_filter").value;
            addLayerToMap()
        })



        //Get the csv file --> On success runs the following command (JavaScript Asynchornus Nature LUL)


        // $.get('./yelp_dataset_food.csv', function (csvString) {


        //     var data = Papa.parse(csvString, { header: true, dynamicTyping: true, skipEmptyLines: true }).data;
        //     //Convert csv (In string format) into array of objects, need to skip empty lines to prevent it from generating a null line

        //     //Building the bubble plot
        //     bubbleplot = L.layerGroup();
        //     data.forEach(element => {
        //         var marker = L.circleMarker([element.latitude, element.longitude],
        //             { radius: 4, stroke: false, fillOpacity: 0.2, fillColor: '#D32727' }).bindPopup(element.name);
        //         bubbleplot.addLayer(marker);
        //     });
        //     //Building the heat plot
        //     LatLongCount = data.map(a => [a.latitude, a.longitude, a.review_count / 9185]); //Divide review count by 9185(max.val)
        //     heat = L.heatLayer(LatLongCount, { radius: 25 });
        //     heat.addTo(map);
        //     bubbleplot.addTo(map);
        //     //Working on Filtering and Group Control (Resolve Z-Index Problem).
        // })

    </script>
</body>


</html>
