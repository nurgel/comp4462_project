<!DOCTYPE html>
<html lang='en'>
    <head>
        <meta charset="UTF-8">
        <title>D3 Choropleth</title>
    </head>
    <!-- Import the required JS files -->
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>

    <!-- Create the initial blank svg -->
    <svg id="Bubble Map" width="968" height ="600"></svg>

    <!-- D3 script -->
    <script>
        //The svg
        var svg = d3.select("svg"),
            width = +svg.attr("width"),
            height = +svg.attr("height");

        var i = 1;
        
        var projection = d3.geoMercator().center([100,50]).scale(240).rotate([-180,0,0]);
        var path = d3.geoPath().projection(projection);
        

        d3.queue()
            .defer(d3.json, "./world.json")  // World shape
            .defer(d3.csv, "./yelp_academic_dataset_business.csv") // Position of circles
            .await(ready);
        
        function ready(error, world, data){
            svg.append("g")
                .selectAll("path")
                .data(world.features)
                .enter()
                .append("path")
                  .attr("fill", "#b8b8b8")
                  .attr("d", path)
                .style("stroke", "none")
                .style("opacity", .3)

            svg
                .selectAll("myCircles")
                .data(data)
                .enter()
                .append("circle")
                  .attr("cx", function(d){ return projection([+d.longitude, +d.latitude])[0] })
                  .attr("cy", function(d){ return projection([+d.longitude, +d.latitude])[1] })
                  .attr("r", function(d){i=i+1; return [console.log(i),5][1]})
                  .style("fill", "steelblue")
                  .attr("fill-opacity", .4)
            }
                    

    </script>
</html>

